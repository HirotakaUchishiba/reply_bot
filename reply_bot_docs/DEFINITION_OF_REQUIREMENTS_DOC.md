## 第1章 プロジェクトビジョンと戦略目標

  
  

### 1.1. はじめに

  

本書は、Slack AI Eメールアシスタントプロジェクトに関する唯一の信頼できる情報源（Single Source of Truth）として機能する。これは、プロジェクトの成功に不可欠な基礎ドキュメントとして提案されたものであり 1、プロジェクトの目標、スコープ、および要件を正式に定義することで、ビジネスステークホルダーと技術チーム間の認識の齟齬を解消することを目的とする。

  

### 1.2. ビジネス上の問題提起

  

現状、イベント掲載プラットフォームへの問い合わせに対応するカスタマーサポート業務は、手動作業への依存度が高い。これにより、応答時間の遅延、回答品質のばらつき、そしてサポート担当者の高い認知的負荷といった問題が生じている。主要ユーザーペルソナである「ヒロタカ」が直面するペインポイントには、定型的な回答の入力に費やされる時間、複数のプラットフォーム（メール、社内ナレッジベース、Slack）間でのコンテキストスイッチングに伴う摩擦、そして問い合わせ内容の解決に必要な社内連携の非効率性が含まれる [User Query]。

  

### 1.3. プロジェクトビジョン

  

Slack内にシームレスなAI拡張ワークフローを構築することにより、カスタマーサポート担当者がより迅速かつ正確に、そして少ない手動作業で問い合わせに対応できる環境を実現する。これにより、従業員体験と顧客満足度の双方を向上させることを目指す。

  

### 1.4. 戦略的ビジネス目標（定量目標）

  

本プロジェクトの成功は、単なる技術的な実装の完了ではなく、測定可能なビジネス成果の達成によって定義される。この原則に基づき、プロジェクトのビジョンを以下の具体的な主要業績評価指標（KPI）に落とし込む。これらのKPIは、機能の優先順位付けからリリース後の効果測定に至るまで、プロジェクト全体の「北極星」として機能する 1。

- BG-01 (効率性の向上): システム導入後6ヶ月以内に、顧客からの問い合わせに対する平均初回応答時間を40%削減する。
    
- BG-02 (生産性の向上): 定型的な問い合わせへの回答に必要な手動作業（キーストローク数やクリック数で測定）を60%削減する。
    
- BG-03 (品質の改善): 応答の一貫性とブランドトーンの遵守を向上させ、エスカレーションや追加の確認依頼の件数を15%削減することで測定する。
    
- BG-04 (ユーザー満足度): システム導入後3ヶ月以内に、主要ユーザーである社内サポートチームから、本ツールに関するネットプロモータースコア（NPS）で+50以上を達成する。
    

これらの定量目標を設定する論理的根拠は、ユーザーペルソナが抱える「時間がかかる」「面倒」といった定性的な課題を、追跡・評価可能な具体的な数値目標に変換することにある。これにより、開発されるすべての機能がこれらの目標達成にどう貢献するかが明確になり、プロジェクトの投資対効果（ROI）を客観的に評価するための基盤が確立される。

---

## 第2章 システムのスコープと境界

  
  

### 2.1. スコープ内の機能

  

スコープクリープを防ぎ、プロジェクトの焦点を明確に保つため、本システムの提供機能を以下に限定する 1。

- 指定されたサポート用メールアドレス（例: support@your-reply-domain.com）宛のメールをAWS SES経由で自動的に取り込む 2。
    
- 日本語のプレーンテキスト形式のメール本文を処理する。
    
- 外部の大規模言語モデル（LLM）で処理する前に、メール内容から個人識別情報（PII）をリダクション（匿名化）する 2。
    
- 新規メール受信時に、指定されたプライベートSlackチャンネルに通知を投稿する 2。
    
- OpenAI API（gpt-4oモデル）を利用して、返信メールのドラフトを生成する 2。
    
- 生成されたドラフトをSlackモーダル内に提示し、担当者によるレビュー、編集、承認を可能にする 2。
    
- ユーザーが承認した最終的な返信メールを、AWS SES経由で元の送信者に送信する [Image 1]。
    
- 非同期プロセスを管理するため、ワークフローの状態（送信者アドレス、pii_mapなど）をDynamoDBに一時的に永続化する 2。
    

  

### 2.2. スコープ外の機能

  

ステークホルダーの期待値を適切に管理するため、以下の機能は本プロジェクトの対象外とする。

- メール添付ファイル（ファイル、画像）の処理。
    
- 日本語以外の言語のサポート。
    
- リッチテキストまたはHTML形式のメールの処理（すべてのメールはプレーンテキストとして扱われる）。
    
- AIとの対話的なやり取り（例：ドラフトを洗練させるためのチャット機能）。インタラクションは、一度の生成とその後の手動編集に限定される。
    
- Slackインターフェース内での、検索可能な過去の会話履歴の保持。履歴は、メールシステムの「送信済み」フォルダで管理されるものとする 1。
    
- 初期通知を超える高度なコラボレーション機能（例：スレッドでの議論、他の担当者への割り当て、モーダル内での内部コメント）。
    
- 人間によるレビューを介さない返信の自動送信（Human-in-the-Loopのステップは必須とする）。
    

このスコープ定義、特に「スコープ外」の項目は、戦略的な判断を反映している。ユーザーペルソナ「ヒロタカ」は、問い合わせ内容の共有や他メンバーへの確認といったコラボレーションに関する非効率性を重要なペインポイントとして挙げている [User Query]。しかし、本システムのバージョン1.0のアーキテクチャとUIフローは、個人の作業効率化に焦点を当てた単一ユーザーのワークフローに最適化されている [Image 1, Image 2]。これは、プロジェクトの初期段階では、中核となるAIドラフト生成機能の確立を最優先するという意図的な決定である。コラボレーションに関する課題への対応は、将来のバージョン（V1.1やV2.0）の重要な機能候補として明確に位置づけられ、初期リリースがすべての問題を解決するわけではないという期待値を関係者間で共有する。

---

## 第3章 ユーザー中心の要件

  
  

### 3.1. 主要ユーザーペルソナ：ヒロタカ

  

本プロジェクトのすべての要件は、以下のユーザーペルソナが抱える課題を解決するために存在する。

- 役割: イベント掲載プラットフォームのカスタマーサポート担当者。
    
- 責任: システムの主要な操作者であり、顧客とのコミュニケーションの最終的な品質に責任を持つ。
    
- 目標: 顧客からの問い合わせに、迅速かつ正確に応答する。
    
- ペインポイント:
    

- 定型的で反復的な回答の入力に費やされる時間。
    
- メールクライアント、社内ナレッジベース、Slack間でのコンテキスト切り替えに伴う認知的負荷。
    
- 返信作業のために外部プラットフォームにログインする必要がある手間。
    
- 問い合わせ内容を他メンバーに共有する際の非効率性（コピー＆ペースト、手動でのメンション）。
    
- 返信前に社内確認が必要な場合の作業負荷によるフラストレーション。
    

  

### 3.2. ユーザーストーリー

  

ヒロタカのニーズを、実行可能な要求事項として以下のように記述する。

- US-01 (通知): カスタマーサポート担当者として、私は新しい顧客からの問い合わせをSlackで即座に通知してほしい。これにより、メールの受信トレイを常に監視する必要がなくなる。
    
- US-02 (文脈情報): カスタマーサポート担当者として、私は送信者の詳細とメッセージの全文をSlack通知内で確認したい。これにより、問い合わせの文脈をすぐに理解できる。
    
- US-03 (AI支援): カスタマーサポート担当者として、私はワンクリックでAIに返信ドラフトを生成させたい。これにより、メッセージの定型部分を作成する時間を節約できる。
    
- US-04 (レビューと管理): カスタマーサポート担当者として、私はAIが生成したドラフトを送信前にレビューし、完全に編集できる必要がある。これにより、内容の正確性、完全性、そしてブランドトーンへの準拠を保証できる。
    
- US-05 (シームレスな送信): カスタマーサポート担当者として、私は最終的な返信をSlackから直接送信したい。これにより、メールクライアントにコンテキストを切り替える必要がなくなる。
    
- US-06 (確認): カスタマーサポート担当者として、私は返信が送信された後にSlackで確認メッセージを受け取りたい。これにより、アクションが正常に完了したという安心感を得られる。
    

---

## 第4章 機能要件 (FR)

  

システムの具体的な振る舞いを、テスト可能な形で以下に詳述する。これらの要件は、アーキテクチャ図 [Image 1] および実装設計仕様書 2 と密接に連携している。

  

### 4.1. メールの取り込みと処理

  

- FR-01: システムは、support@your-reply-domain.com 宛のメールを、AWS SESの受信ルール（Receipt Rule）経由で受信するものとする 2。
    
- FR-02: SESの受信ルールは、主要なAWS Lambda関数を非同期（InvocationType: "Event"）でトリガーするものとする 2。
    
- FR-03: Lambda関数は、生のメールデータから送信者のメールアドレス、送信者名（利用可能な場合）、件名、およびプレーンテキスト形式の本文を抽出するものとする。
    

  

### 4.2. PIIリダクションと状態管理

  

- FR-04: システムは、外部APIを呼び出す前に、抽出したメール本文をPIIリダクション・サブシステム（例：Presidioライブラリ）で処理し、個人識別情報を特定・置換するものとする 2。
    
- FR-05: リダクション処理は、元のPIIとそのプレースホルダーの対応関係を保持するマッピング（pii_map）を生成しなければならない。このマップは極めて重要な状態情報である 2。
    
- FR-06: システムは、新規メールのワークフローごとに一意のコンテキストID（例：UUID）を生成するものとする。
    
- FR-07: システムは、ワークフローの完全なコンテキスト（送信者アドレス、件名、元の本文、リダクション済み本文、およびpii_mapを含む）を、コンテキストIDを主キーとしてAmazon DynamoDBテーブルに永続化するものとする 2。
    

  

### 4.3. Slack連携と通知

  

- FR-08: 新規メールの処理に成功した場合、システムは事前設定されたSlackチャンネルに通知メッセージを投稿するものとする。
    
- FR-09: 通知メッセージは、実装設計仕様書で定義されたBlock KitのJSON構造に準拠し、送信者、件名、およびメール本文の抜粋を表示するものとする 2。
    
- FR-10: 通知には、「返信文を生成する」というラベルのプライマリアクションボタン（action_id: "generate_reply_action"）を含めるものとする。
    
- FR-11: このボタンのvalueフィールドには、ユーザーのアクションをDynamoDBに保存された状態に紐付けるため、JSONシリアライズされたコンテキストIDを格納しなければならない 2。
    

  

### 4.4. AIによるコンテンツ生成

  

- FR-12: ユーザーが「返信文を生成する」ボタンをクリックすると、SlackはシステムのAmazon API Gatewayエンドポイントにblock_actionsペイロードを送信するものとする 2。
    
- FR-13: API GatewayによってトリガーされたLambda関数は、イベントルーターとして機能し、イベントソースがSlackのボタンクリックであることを識別するものとする 2。
    
- FR-14: 関数は、ペイロードに含まれるコンテキストIDを使用して、DynamoDBから完全なワークフローコンテキストを取得するものとする 2。
    
- FR-15: システムは、構造化されたフレームワークを用いてOpenAI APIへのプロンプトを構築するものとする。これには、事前定義されたペルソナ、指示、およびリダクション済みのメール本文を組み合わせる 2。
    
- FR-16: システムは、APIコントラクトで指定された通り、コストを管理するために最大トークン数を設定してOpenAI API（gpt-4oモデル）にリクエストを送信するものとする 2。
    

  

### 4.5. Human-in-the-Loop (HITL) インターフェース

  

- FR-17: OpenAIからの応答を受信後、システムは保存されたpii_mapを使用して、生成されたテキストに対して「再識別化（デ・アノニマイゼーション）」処理を行い、プレースホルダーを元のPII値に復元するものとする 2。
    
- FR-18: システムは、Slack APIのviews.openメソッドを使用して、ボタンをクリックしたユーザーに対してモーダルダイアログを表示するものとする 2。
    
- FR-19: モーダルは、実装設計仕様書で定義されたBlock KitのJSON構造に準拠し、タイトル、編集可能な複数行テキスト入力、送信ボタン、およびキャンセルボタンを備えるものとする 2。
    
- FR-20: 編集可能なテキスト入力（action_id: "editable_reply_input"）には、再識別化されたAI生成の返信ドラフトが事前に入力されているものとする。
    
- FR-21: ユーザーは、入力フィールドのテキストを自由に変更または完全に置き換えることができるものとする。
    
- FR-22: ユーザーがモーダルを送信すると、SlackはAPI Gatewayエンドポイントにview_submissionペイロードを送信するものとする。ペイロードには、静的IDであるblock_id: "editable_reply_block"およびaction_id: "editable_reply_input"を介してアクセス可能な、最終的に編集されたテキストが含まれていなければならない 2。
    

  

### 4.6. メールの発送と確認

  

- FR-23: Lambda関数のイベントルーターは、view_submissionイベントタイプを識別するものとする 2。
    
- FR-24: 関数は、モーダルのprivate_metadataに保存されたコンテキストIDを使用して、DynamoDBから再度ワークフローコンテキストを取得するものとする。
    
- FR-25: システムは、AWS SESのSendEmail APIを使用して、ユーザーが編集した最終テキストをメールとして送信するものとする。宛先アドレスと件名は、保存されたコンテキストから取得する 2。
    
- FR-26: SES経由での送信が成功した場合、システムはSlackでユーザーに対して一時的な確認メッセージ（例：「hogehoheさんへの返信が完了しました」）を投稿するものとする [Image 2]。
    
- FR-27: ワークフローの正常完了後、システムは処理済みデータをクリーンアップするため、DynamoDBから対応する状態アイテムを任意で削除することができる。
    

---

## 第5章 非機能要件 (NFR)

  

システムの品質特性を形式化し、実装設計仕様書 2 に示された優れた技術原則を監査可能な要件に変換する。これらの要件は単なる技術的な制約ではなく、ビジネスリスクを直接的に軽減するための工学的要求事項である。

  

### 5.1. セキュリティ (NFR-SEC)

  

- NFR-SEC-01 (PIIリダクション): システムは、OpenAI APIへの送信前に、ユーザーコンテンツからメールアドレス、電話番号、クレジットカード番号を99.9%の目標精度でリダクションしなければならない。これは最優先のセキュリティ要件である 2。
    
- NFR-SEC-02 (シークレット管理): すべてのシークレット情報（OpenAI APIキー、Slackボットトークン等）はAWS Secrets Managerに保存し、IAMロール経由でアクセスしなければならない。アプリケーションのソースコードにハードコーディングしてはならない 2。
    
- NFR-SEC-03 (最小権限): Lambda実行IAMロールは最小権限の原則に従い、CloudWatch Logs、DynamoDB、Secrets Manager、およびSESに必要な権限のみを付与するものとする 2。
    
- NFR-SEC-04 (データ暗号化): DynamoDBテーブルに保存されるデータは、AWS管理キーを使用して保存時に暗号化（Encryption at Rest）されなければならない 2。
    
- NFR-SEC-05 (ドメイン認証): 送信元メールのドメインには、なりすまし防止と到達率向上のため、有効なSPF、DKIM、およびDMARC（最低でもp=noneの監視モード）レコードが設定されていなければならない 2。
    

  

### 5.2. 信頼性 (NFR-REL)

  

- NFR-REL-01 (データ損失防止): システムは、受信メールイベントの損失がゼロであることを保証しなければならない。これは、主要Lambda関数にSQSデッドレターキュー（DLQ）を設定し、デフォルトリトライ後に処理失敗したイベントを捕捉することで達成される 2。この要件は、顧客からの問い合わせが失われるというビジネスリスクに対する直接的な緩和策である。
    
- NFR-REL-02 (冪等性): システムのインタラクションは、リトライ発生時に重複アクションを防ぐため、可能な限り冪等に設計されるべきである。
    
- NFR-REL-03 (状態の永続性): システムは、複数の独立したLambda実行をまたいで、ワークフローの状態を確実に永続化しなければならない。DynamoDB内のpii_mapの損失は、特定のワークフローにおける致命的な障害と見なされる 2。
    

  

### 5.3. パフォーマンス (NFR-PER)

  

- NFR-PER-01 (モーダル表示遅延): ユーザーが「返信文を生成する」ボタンをクリックしてから、AIドラフトを含むモーダルが表示されるまでの時間は、リクエストの95パーセンタイル（p95）において5秒未満でなければならない 1。
    
- NFR-PER-02 (エンドツーエンドスループット): システムは、最低10件の同時リクエストを、著しいパフォーマンス低下なく処理できるべきである。
    

  

### 5.4. コンプライアンス (NFR-COM)

  

- NFR-COM-01 (データプライバシー): システムは、CloudWatch Logsやその他のロギングシステムに、生のPIIを記録してはならない 2。
    
- NFR-COM-02 (第三者へのデータ送信): システムは、OpenAIを含むいかなる第三者サービスにも、生のPIIを送信してはならない 1。
    

  

### 5.5. ユーザビリティ (NFR-USA)

  

- NFR-USA-01 (最小コンテキストスイッチ): 通知から最終的な送信まで、ワークフロー全体がSlackインターフェース内で完結しなければならない。
    
- NFR-USA-02 (明瞭性): ユーザーに表示されるすべてのメッセージ（通知、モーダル、確認）は、明確かつ簡潔な日本語で記述されなければならない。
    

  

### 5.6. 保守性・可観測性 (NFR-MNT)

  

- NFR-MNT-01 (構造化ロギング): Lambda関数からのすべてのログ出力は、構造化されたJSON形式であり、単一リクエストのライフサイクル全体を追跡するための相関IDを含まなければならない 2。
    
- NFR-MNT-02 (主要メトリクスの監視): システムは、実装設計仕様書の可観測性フレームワークで定義された主要メトリクス（Lambdaエラー、API Gateway 5XXエラー、およびSESのレピュテーションメトリクスReputation.BounceRate, Reputation.ComplaintRate）に対する監視とアラートを提供しなければならない 2。特にSESのレピュテーション監視は、ドメインがブラックリストに登録されるという、アプリケーションの存続を脅かすビジネスリスクを軽減するために不可欠である。
    
- NFR-MNT-03 (Infrastructure as Code): すべてのクラウドインフラは、再現性とバージョン管理を保証するため、コード（例：Terraform）として定義・管理されなければならない 2。
    

---

## 第6章 前提条件、制約、依存関係

  
  

### 6.1. 前提条件

  

- 主要ユーザー（サポート担当者）は、有効なSlackアカウントを保有し、その基本操作（チャンネル、ボタン、モーダル）に習熟している。
    
- イベントプラットフォームからの問い合わせは、標準的なプレーンテキスト形式のメールで送信される。
    
- メールの量は、AWS Lambda、SES、API Gatewayのデフォルトのサービスクォータの範囲内である。
    

  

### 6.2. 制約

  

- ソリューションは、実装設計仕様書 2 で定義されたサーバーレスアーキテクチャを用いて、AWS上に構築されなければならない。
    
- LLMプロバイダーはOpenAIとし、特にgpt-4oのAPIコントラクトと互換性のあるモデルを使用する。
    
- ユーザーインターフェースは、SlackのBlock Kitフレームワークの機能範囲に限定される。
    

  

### 6.3. 依存関係

  

- システムは、SlackプラットフォームAPIの可用性とパフォーマンスに依存する。
    
- システムは、OpenAI APIの可用性とパフォーマンスに依存する。
    
- システムは、基盤となるAWSサービス（SES, Lambda, DynamoDB, API Gateway）の運用状態に依存する。
    

---

## 付録A: 要件追跡マトリクス

  

このマトリクスは、プロジェクト提案書で強く推奨されている通り、戦略的なビジネス目標と、実装される具体的な要件との間の監査可能な関連性を提供する 1。これにより、すべての作業が定義された目的に貢献していることを保証し、要件変更時の影響分析のための強力なツールとなる。例えば、BG-01（効率性の向上）の優先度が下げられた場合、影響を受けるすべてのユーザーストーリーと機能要件を即座に特定できる。

|   |   |   |   |   |
|---|---|---|---|---|
|ビジネス目標ID|ユーザーストーリーID|機能要件(FR)|非機能要件(NFR)|テストケースカテゴリ|
|BG-01, BG-02|US-03|FR-12, FR-15, FR-16|NFR-PER-01|E2E-AI-Generation|
|BG-01, BG-02|US-05|FR-22, FR-25|NFR-USA-01|E2E-Send-Workflow|
|BG-03|US-04|FR-18, FR-19, FR-20, FR-21|NFR-USA-02|INT-Modal-Editing|
|BG-04|US-01, US-06|FR-08, FR-26|NFR-PER-01|E2E-Full-Workflow|
|すべて|すべて|FR-04, FR-05|NFR-SEC-01, NFR-COM-02|UNIT-PII-Redaction|
|すべて|すべて|FR-01, FR-02|NFR-REL-01|FAIL-DLQ-Test|

このマトリクスの構築プロセス自体が、要件間の関係性を深く理解する上で重要な分析ツールとなる。特に注目すべきは、「ビジネス目標ID: すべて」と記載された行である。これは、PIIリダクション（FR-04）やデータ損失防止（NFR-REL-01）といった機能が、特定の単一ビジネス目標に貢献するのではなく、プロジェクト全体の存立基盤を成す横断的な懸念事項であることを示している。これらの要件が満たされない場合、コンプライアンスや信頼性の観点からシステムは稼働できず、結果としてすべてのビジネス目標が達成不可能になる。この視覚的な表現は、これらの要件を単なる機能の一つとしてではなく、アーキテクチャの根幹をなす柱として位置づけ、開発、テスト、保守において最優先で扱われるべきであることを明確に示している。

#### 引用文献

1. 開発資料の網羅性と不足資料の提案
    
2. 実装設計仕様書
    

**